\documentclass[a4paper]{report}
\usepackage[utf8]{inputenc}
\usepackage[portuguese]{babel}
\usepackage{hyperref}
\usepackage{a4wide}
\hypersetup{pdftitle={CC - TP02},
pdfauthor={João Teixeira, José Ferreira, Miguel Solino},
colorlinks=true,
urlcolor=blue,
linkcolor=black}
\usepackage{subcaption}
\usepackage[cache=false]{minted}
\usepackage{listings}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{appendix}
\usepackage{tikz}
\usepackage{authblk}
\usepackage{bashful}
\usepackage{verbatim}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{tikz,fullpage}
\usepackage{pgfgantt}
\usetikzlibrary{arrows,%
                petri,%
                topaths}%
\usepackage{tkz-berge}
\usetikzlibrary{positioning,automata,decorations.markings}
\AfterEndEnvironment{figure}{\noindent\ignorespaces}
\AfterEndEnvironment{table}{\noindent\ignorespaces}

\begin{document}

\title{Comunicação por Computadores\\ 
\large Fase 2 - Grupo 7}
\author{José Ferreira (A83683) \and João Teixeira (A85504) \and Miguel Solino (A86435)}
\date{\today}

\begin{center}
    \begin{minipage}{0.75\linewidth}
        \centering
        \includegraphics[width=0.4\textwidth]{images/eng.jpeg}\par\vspace{1cm}
        \vspace{1.5cm}
        \href{https://www.uminho.pt/PT}
        {\color{black}{\scshape\LARGE Universidade do Minho}} \par
        \vspace{1cm}
        \href{https://www.di.uminho.pt/}
        {\color{black}{\scshape\Large Departamento de Informática}} \par
        \vspace{1.5cm}
        \maketitle
    \end{minipage}
\end{center}

\chapter{Introdução}

\chapter{Arquitetura da Solução}

\chapter{Especificações do protocolo UDP}
\chapter{Formato de Mensagens Protocolares (PDU)}

Cada PDU é composto por oito campos, sete para o header e um ultímo
para o conteudo a transmitir. Um PDU tem um tamanho máximo de 4096,
e, o conteudo de cada um é, no máximo 1792 bytes, para dar espaço
para a encriptação do mesmo. Caso o conteudo seja de tamanho 
superior ao que um PDU é capaz de transmitir, este será fragmentado
e identificado de forma a que seja possível a junção de todos os
fragmentos.

\section{Header}

\subsection{id}
Este campo identifica sequencialmente cada leitura de uma socket TCP,
tanto originados pelo cliente como pelo servidor de destino. Também 
tem a finalidade de sincronização nas threads de escrita para uma
socket TCP, garantindo assim que pacotes são entregues de forma ordenada.

\subsection{total_blocks}
Tendo em conta a possível fragmentação do conteudo por multiplos PDUs,
este campo tem a informação do número total de PDUs criados para alojar
todo o conteudo desejado.

\subsection{block_number}
Aquando da fragmentação do conteudo por vários PDUs, é atribuido sequencialmente
um identificador de cada fragmento, começando em 0, até \textit{total_blocks
- 1}, para ser possível a reconstrução do conteudo fragmentado, e assegurar
a ordem do mesmo.

\subsection{origin_id}
Para ser possível diferenciar os pacotes e convenientemente entregues ao 
destino, ao serem recebidos pelo túnel UDP, é guardada no PDU o IP do 
Gateway que o enviou.

\subsection{thread_id}
Para ser possível diferenciar os PDUs provenientes do mesmo Gateway,
é armazenado o identificador único da thread que enviou o PDU.

\subsection{signature}
De forma a ser possível verificar se o PDU foi adulterado ou proveniente
de uma origem que não a desejada, este campo contém a hash do conteudo
encriptada com a chave privada do Gateway que enviou o PDU.

\subsection{kind}
Para diferenciar os diferentes tipos de PDU, cada PDU tem um campo
com a informação de a que tipo corresponte, com um dos tipos abaixo
listados, para poder ser tratado da forma correta pelo Gateway de 
destino.
\begin{itemize}
        \item Syn
        \item SynAck
        \item Content
        \item Reply
        \item Ack
        \item Fin
        \item FinAck
\end{itemize}

Os pacotes de tipo \textit{Syn} marcam o início de uma conecção, enviado
pelo Gateway ao qual o cliente se ligou por TCP. Os \textit{SynAck}
é a resposta do Gateway que se vai ligar por TCP ao servidor de destino
a um PDU do tipo \textit{Syn}.

Um PDU do tipo \textit{Content} é responsável pela transmição do conteudo
de um request TCP proveniente do cliente. Estes PDUs apenas têm origem
no Gateway onde o cliente TCP se conectou. Um PDU do tipo \textit{Reply}
é um PDU análogo ao um do tipo \textit{Content}, mas este apenas tem origem
no Gateway conectado ao servidor de destino.

Os PDU do tipo \textit{Ack} são transmitido com o campo do \textit{content}
vazio, e é enviado como confirmação da receção de outros PDUs.

Os PDU do tipo \textit{Fin} e \textit{FinAck} marcam o fim da transmição,
e são enviados quando a socket TCP do cliente ou do servidor são fechadas.
Os do tipo \textit{Fin} são enviados pelo Gateway incial quando é o 
cliente a fechar a conecção, e os \textit{FinAck} são enviados pelo Gateway
conectados ao servidor de destino, quando este fecha a conecção TCP.

\section{Interações}

\chapter{Implementação}
\section{detalhes, Parametros, bibliotecas de funções, etc}

\chapter{Testes e Resultados}

\chapter{Conclusões e Trabalho Futuro}

\end{document}
